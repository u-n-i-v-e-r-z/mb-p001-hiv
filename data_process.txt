 Hi-C processing

Hi-C data were processed using the Juicer pipeline (Durand et al., 2016) for visualisation and HicExplorer 3.7.1 for processing. In short, Hi-C reads were mapped to DnpII restriction fragments (hg19). Duplicates reads with MAPQ < 30, and intra-fragment reads were removed. Reads were then binned to generate contact matrices for all chromosomes at resolutions 5, 10, 25, 50, 100, 250, 500, 1000 and 2500 kb. Contact matrices were next normalized by reads depth and corrected using KR matrix balancing algorythm.

  Topologically associating domains (TADs) were identified using hicExplorer (publi) at 25/50 kb resolution. Around 4500/3800 TADs were identified, and their median size was around 325/500 kb respectively. TADs could not be identified at lower resolutions due to matrix sparsity. TADs were then annotated according to TT-seq data: TADs were considered as active if the average TT-seq TPM (transcripts per kilobase million) was superior to 10, and were considered as inactive if not.


# Loops were detected using the HiCCUPS algorithm (Rao et al., 2014) at 10 and 25 kb resolutions. Around 8000 loops were detected. Similarly, loops could not be detected at lower resolutions due to matrix sparsity.


  Enrichment analysis in tri-dimensional chromatin structure context 
Enrichment of HIV IS in active TADs was assessed. For this purpose, IS were first mapped to genes. Then the enrichment of genes with IS in active TADs was compared to the enrichment of genes without IS in active TADs using the Fisher’s exact test. Similarly, the enrichment of genes with IS at loop anchors was compared to the enrichment of genes without IS at loop anchors using the Fisher’s exact test. 

In active TADs, we assessed the enrichment of histone marks between TADs with IS (IS enriched domains) and TADs without IS (IS depleted domains). We used the Wilcoxon rank-sum test to assess the significance of the enrichment difference. 
To assess the enrichment of IS at TAD borders, we computed an average profile of the number of IS that overlap TAD borders and the surrounding regions. Similarly, we computed average profiles of the number of IS that overlap enhancers (Andersson et al., 2014) and super-enhancers (Khan & Zhang, 2016) and the surrounding regions. 

The enrichment of histone marks at enhancers/super-enhancers overlapping IS was compared between active and quiescent cells, depending on gene status (induced, repressed or unchanged). We used the Wilcoxon rank-sum test to assess the significance of the enrichment difference.


  Interaction between IS analysis in Hi-C
To see if IS are more in contact in 3D context we split Hi-C normalized contact into ten equally sized groups (at 50 kb resolution) and count the proportion of IS contacting IS (or IS contacting others regions).


  APA analysis
To test the specific interaction between IS-IS, IS-TSS and IS-enhancers/super-enhancers in elite controllers (De novo EC IS), healthy donors (De novo HD IS) and cART-treated studies (cART all IS), respectively, we use Hi-C matrix normalized at 50 kb resolution. Then we aggregate all local matrices by computing the mean of normalized contacts between all pairs that have a minimal distance of 1 Mb. 


  APA differential boxplot
We take the center of APA matrix and normalize by the bottom right of APA to have a factor of correction. We then apply this factor on all values of the matrices and performed a two-sided pairwise Wilcoxon rank-sum test. The enhancer annotation came from http://enhanceratlas.org/ (CD4+ ells).



  Promotor and reciprocal capture Hi-C
 
We used processed Promotor Capture data from Javierre et al., 2016 (https://osf.io/u8tzp). Briefly, data were mapped to GRCh37 using the HiCUP pipeline (https://www.bioinformatics.babraham.ac.uk/projects/hicup/), and interaction confidence scores were computed using the CHiCAGO pipeline (Cairns et al., 2016). We considered the set of interactions with high confidence scores (>=5) in this paper. We then constructed a network with significant interactions using igraph R package (version 1.1.2). Each node of the network represents HindIII fragments, and edges represent a significant interaction between two HindIII fragments. We constructed three networks. One for resting CD4 T cells (naCD4) specific interactions, one for Activated CD4 T cells (aCD4) specific interactions and one by merging all significant interactions between Resting and Activated CD4 T cells.
We used the R package igraph to analyze contact networks and visNetwork (v2.0.8) for visualization.


  Assortativity of HIV-1 IS
We used the R data.table package to annotate HindIII fragments harbouring one or more IS (Boolean value) using foverlaps function. Assortativity was then computed on the constructed network using the R igraph package. To give significance to computed assortativity of IS, we randomly selected the same amount of nodes as those with IS and thus computed a “control” assortativity.


  Overlap between IS from several studies in a tri-dimensional chromatin structure 
Venn diagrams were made using VennDiagram R package (1.6.18). We calculated overlaps at three different levels. HindIII fragments that are either common to both studies (level 0), directly in contact with an IS-containing fragment from the other study (level 1) or in contact with a fragment that also contacts an IS-containing fragment from the other study (level 2). To test the significance we use the same strategy than for assortativity significance (bootstrapping).
 
 
  Enrichment of IS in the network
The majority of IS are found in what we termed a super-graph, so we decided to cluster the super-graph into communities using the fastgreedy.community function implemented in the igraph R package. This function uses a measure of modularity; it compares the number of intra versus inter-community connections to optimize clustering.

TPM values for each fragment were calculated using the mean TPM from 2 donors. We first computed the mean TPM of all genes, then selected genes that overlap each fragment. If there were multiple genes per fragment, we used their median values.

The size of graphs or communities corresponds to the total length of fragments (in bp). To measure the enrichment of IS we used a binomial law with the number of fragment with IS and size of graph/community (in bp). The probability is calculated as the total number of IS in captured fragments divided by the total length of captured fragments.

p(fragment with IS) = ∑ (length of fragment with IS)/∑ (length of all captured fragments)


  Overlap between patients/studies statistics
We wanted to calculate the probability that a community enriched in IS could be common to multiple studies by chance. To this end we calculated the probability of having an enriched community for each patient/study and then used a binomial law to determine the expected number of common enriched communities:
(1)P(a ∩  b ∩ c) = P(a)*P(b)*P(c)
(2)P((a ∩ b) ∪ (a ∩ c) ∪ (b ∩ c ))  = (P(a)*P(b)) + (P(a) *P(c)) + (P(b)*P(c)) – (1) 
(3)P(a ∪ b ∪ c)  = P(a) + P(b) + P(c) – (2)

  Transcriptional and epigenetic analysis of communities enriched with IS versus not enriched with IS
Groups are based on enrichment in IS from the cART studies: “enriched” when p-value <= 0.05, "not enriched" when p-value > 0.05 & number of IS > 0, without IS when number of IS == 0.
For TT-seq data we used the median of fragment TPMs overlapping genes by communities. For ChIP-seq data, we compute the normalized mean of the signal by fragment and use mean of this value for each community.
 
  TT-seq
  Transient Transcriptome sequencing in Resting and activated CD4 T cells from healthy donors
TT-seq library construction was done using protocol from (Schwalb et al., 2016). Briefly, purified CD4+ T-cells were labeled in culture media for 5 min with 500µM 4-thiouridine (4sU, Sigma-Aldrich). Cells were harvested, spike-ins were added, RNA was purified using QIAzol lysis reagent (Qiagen) and fragmented on Bio-Ruptor with a High setting for one cycle 30s ON - 30s OFF. Fragmentation efficiency was analyzed on the Agilent Bioanalyzer 2100 with an RNA 6000 Pico kit (Agilent Technologies). Fragmented RNA was biotinylated with Biotin-HPDP EZ link (Thermo Fisher Scientific) and purified with chloroform and precipitated with isopropanol. Biotinylated RNA labeled with Streptavidin beads (µMacs Streptavidin Kit – Miltenyi Biotec.) with a ratio of 1:1 then purified on µMACs columns (Miltenyi Biotec). RNA cleaning was done with Agencourt RNAclean XP beads (Beckman Coulter) with a ratio 1,8:1. Sequencing libraries were prepared with the Ovation Universal RNA-seq library Kit (NuGEN) following the manufacturer's instructions. Libraries were paired-end sequenced (50bp) on an Illumina HiSeq 2500.

  
Reads were mapped to human genome GRCh37 (ftp://ftp.ensembl.org/pub/release-75/fasta/homo_sapiens/dna/) using STAR (Dobin et al., 2013), (version STAR_2.5.1b_modified) with default parameters. Annotations from ENSEMBL (GRCh37 release 75) were used for genome indexing with STAR before mapping. We used RSEM (B. Li & Dewey, 2011) (v1.2.29) to compute Transcripts Per Million (TPM) values of all annotated Transcripts: 

rsem-calculate-expression --paired-end --star --estimate-rspd --append-names --star-gzipped-read-file --strand-specific --forward-prob 1 --time --calc-pme -calc-ci

To fix thresholds of transcription we use control genes known to be expressed or not expressed in the same cell types used in this study (Supplementary Figure 1). Based on the value of TPM of control genes we empirically set this value to 6 TPM. Differential expression was assessed using htseq-count (Anders, Pyl, & Huber, 2015) (Part of the 'HTSeq' framework, version 0.7.2) and DESeq2 (Rajkumar et al., 2015) (DESeq2_1.12.4) from Bioconductor:

htseq-count --format=bam --order=pos --mode=union --stranded=yes --type=exon --idattr=gene_id {input}  GTF

We generate normalised genome-wide coverage bigwig files using deeptools 2 software (Ramírez et al., 2016)(version 2.5.3) as follow:

bamCoverage -b {bamFile} -o {bigwigFile} --normalizeUsingRPKM --binSize 10 --smoothLength 30 --minMappingQuality 20 
 
 
 ChIP-seq
 Chip-seq of Histone modification of Resting and Activated CD4 T cell
We use raw read from publicly available data from (Burren et al., 2017). Reads were mapped to the human genome (GRCh37) using BWA (H. Li & Durbin, 2009)(bwa_aln 0.7.10-r789) with default parameters.
Fragment length were inferred before peaks calling using MaSC.pl (Ramachandran, Palidwor, Porter, & Perkins, 2013) (Version 1.2.1), the mappability track were generated using GEM-mappability (Derrien et al., 2012) (build 1.315 (beta)). Peaks were called using MACS2 (Zhang et al., 2008) (version 2.1.1.20160309):
macs2 callpeak -t {IP} -c {input} -f BAM --gsize hs --nomodel --extsize {fragment_length} (--broad) --keep-dup 1 
Parameter --broad was used for histone mark with broad domain of enrichment (H3K9me3, H3K27me3, H3K36me3, H3K4me1).
Meta-gene profiles were generated using deeptools 2. First, normalised genome wide coverage bigwig files were generated using bamCompare with signal extraction scaling (SES) normalization method to subtract background:
bamCompare --bamfile1 {IP} --bamfile2 {Input} --scaleFactorsMethod SES --sampleLength 1000 --numberOfSamples 100000 --outFileName {IP.norm.bw} --pseudocount 0 --ratio subtract --binSize 10 --smoothLength 30   --minMappingQuality 20 --extendReads {fragment.length}

Then we constructed meta-gene matrices using deeptools computeMatrix and annotation file from ENSEMBL (release 75):
computeMatrix scale-regions --regionsFileName Homo_sapiens.GRCh37.75.bed --scoreFileName {input.normalised} --outFileName {output} --upstream 2000 --unscaled5prime 500 --regionBodyLength 2000 --unscaled3prime 500 --downstream 2000 --binSize 50 --sortRegions “descend” --sortUsing “mean”

Finally, we plotted meta-gene average profile with R scripts using the data.table and the ggplot package. We split genes into four groups using TPM values from RSEM and IS from cART-treated individuals studies as follow:
 -HIV targeted genes (from the cART-treated study)
 -Untranscribed genes (below 6 TPM)
 -Transcribed genes
 -Highly transcribed genes

Untranscribed genes were determined using the median of all genes below 6 TPM. Above this threshold, genes were split into two equally sized groups based on TPM values. The highest half was labelled "Highly transcribed", the lowest "Transcribed genes". 
Chip-seq enrichment around HIV-1 Integration Site positions

We then sought to compare Chip-seq patterns between IS positions and randomly selected positions in genes with similar expression levels. To do so, we split all genes targeted by HIV in the cART studies into ten equally sized bins based on the TT-seq TPM values. We then selected random genes not targeted by HIV and matched them to the same amount of HIV targeted genes from the same bin. 
We then use deeptools constructMatrix to construct matrices used to plot average profile around IS. We test the significance of differences using a Wilcoxon rank-sum test with the average signal of +/- 50 bp around IS versus average signal around random position.


 RNA-seq
 

Reads were mapped to human genome GRCh37 (ftp://ftp.ensembl.org/pub/release-75/fasta/homo_sapiens/dna/) using STAR (Dobin et al., 2013), (version STAR_2.5.1b_modified) with default parameters. Annotations from ENSEMBL (GRCh37 release 75) were used for genome indexing with STAR before mapping. We used RSEM (B. Li & Dewey, 2011) (v1.2.29) to compute Transcripts Per Million (TPM) values of all annotated Transcripts: 

rsem-calculate-expression --paired-end --star --estimate-rspd --append-names --star-gzipped-read-file --strand-specific --forward-prob 1 --time --calc-pme -calc-ci

htseq-count --format=bam --order=pos --mode=union --stranded=yes --type=exon --idattr=gene_id {input}  GTF

We generate normalised genome-wide coverage bigwig files using deeptools 2 software (Ramírez et al., 2016)(version 2.5.3) as follow:

bamCoverage -b {bamFile} -o {bigwigFile} --normalizeUsingRPKM --binSize 10 --smoothLength 30 --minMappingQuality 20 











